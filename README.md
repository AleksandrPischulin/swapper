# Swapper
Мобильное приложение для обмена предметами между пользователями с возможностью продажи предметов за внутреннюю валюту

## Техническое задание

### 1. Цель проекта
Цель проекта — разработать приложение для обмена предметами между пользователями (далее Приложение). Пользователи смогут выкладывать вещи, которые хотели бы обменять. Обмен можно совершить как на другой предмет, так и на внутреннюю валюту (цену своего предмета пользователь определяет самостоятельно). Пользователи будут иметь рейтинг  и отзывы по результатам предыдущих обменов. Такое приложение позволило бы повлиять на снижение уровня потребления в целом, а так же могло бы стать хорошим подспорьем для коллекционеров

### 2. Описание приложения
Приложение должно иметь следующие функциональные блоки:
1. Регистрация, аутентификация и авторизация пользователей с использованием телефона
2. Отправка уведомлений пользователям на почту при их согласии
3. Функционал для владельца предмета (добавление, редактирование, удаление)
4. Функционал для обмена предметами
5. Уведомления об обменах/предложениях обмена
6. Функционал для зачисления и списания внутренней валюты
7. Функционал для отзывов и выставления оценок пользователям, с которыми был совершен обмен
8. Внутренний чат для общения по сделке, а так же возможности задать вопросы по предмету обмена 
9. Функционал для рассчета рейтинга пользователя
10. Функционал для подтверждения выполненного обмена обеими сторонами
11. Функционал для "свайпов" с экрана смартфона предложений об обмене (как в тиндере)
12. Функционал для возможности определять на каком расстоянии от пользователя можно совершать обмен (как в тиндере)
13. Функционал для возможности фиксировать количество просмотров предмета

### 3. Типы и права пользователей
Приложение подразумевает только 1 тип пользователей, но необходимо будет разделять права на возможности взаимодействия с предметов в зависимости от факта владения пользователя этим предметом.

### 4. Функционал пользователя
#### 4.1. Регистрация
Пользователь при регистрации будет указывать следующие обязательные данные:
- Адрес
- Телефон
- Имя
- Пароль

Телефон необходимо будет подтвержать путем получения SMS-кода

#### 4.2. Редактирование профиля пользователя
Профиль пользователя будет содержать следующие необязательные данные:
- Аватар
- Email
- Дата рождения
- О себе
- Интересы
- Возможность ограничить получение сообщений от других пользователей
- Возможность отключить уведомления на email

Пользователю будет разрешено редактировать все данные профиля (включая обязательные)
При смене телефона/емейла/пароля необходимо будет дополнительное подтверждение по SMS или Email

#### 4.3. Работа с предметами
##### 4.3.1. Создание нового предмета
При создании нового предмета нужно указать следующие данные (обязательность указана в скобках):
- Фото (обязательно)
- Название (обязательно)
- Категория (обязательно)
- Состояние (обязательно)
- Город, индекс для почтовой отправки (обязательно)
- Год выпуска/производства (необязательно)
- Цена во внутренней валюте (необязательно)
- Рассматривать обмен только на определенные категории (необязательно)
- Скрыть предмет из списка предложений обмена для других пользователей (необязательно)

##### 4.3.2. Редактирование предмета
Редактировать можно только предметы, которые на данный момент не участвуют в обмене.
Предметы, которые находятся в процессе обмена, или по которым обмен завершен редактировать нельзя
У предметов, которые можно редактировать доступны для редактирования все поля

##### 4.3.3. Удаление предмета
Удалять можно только предметы, которые на данный момент не участвуют в обмене.

##### 4.3.4. Демонстрация предметов и добавление в архив
Предметы, обмен по которым завершен (второй юзер подтвердил получение предмета, либо направил жалобу) направляются в архив и становятся недоступны для обмена, однако другие пользователи могут посмотреть предмет и участников сделки.

##### 4.3.5. Демонстрация списка предметов
У каждого пользователя будет 4 категории предметов, в зависимости от статуса обмена по данным предметам
- Доступны к обмену (предметы, на которые пользователь готов обменяться)
- Обмен в процессе (предметы, по которым запущен процесс обмена. Другие пользователи могут только их посмотреть, но не могут предложить на них поменяться)
- Обмен завершен (предметы, по которым завершен процесс обмена. Другие пользователи могут только их посмотреть, но не могут предложить на них поменяться)
- Закрытые для обмена предметы (эти предметы видит только владелец, т.к. он сам умышленно скрыл возможность обмена для них)

### 5. Функционал обмена предметами
Обмен предметов имеет несколько состояниий (далее - Статусы):
1. Обмен предложен
2. Обмен начат
3. Обмен в процессе
4. Обмен завершен
5. Обмен отменен
6. Обмен отклонен

Переход между статусами может быть только последовательным (1 - 2 - 3 - 4)
Отменить можно только обмен в статусе "Обмен начат"
Отклонить можно только обмен в статусе "Обмен предложен"

Так же есть набор способов обмена, который будет пополняться со временем:
- Способ обмена (выбирается один из вариантов: личная встреча, почтовый сервис, оплата внутренней валютой)

#### 5.1. Обмен предложен
Когда пользователь решил сделать предложение об обмене - он направляет пользователю, с которым хотел бы обменяться, следующую информацию: 
- Предмет обмена со своей стороны (либо внутренняя валюта + цена)
- Способ обмена со своей стороны (как он готов передать пользователю свой предмет обмена). Если пользователь оплачивает предмет внутренней валютой, то способ по умолчанию = "внутренняя валюта"

#### 5.2. Обмен начат
Обмен переходит в статус "Обмен начат" только если пользователь, которому предложили обмен заполнил аналогичную информацию и подтвердил готовность обмена
- Предмет обмена (заполняется заранее исходя из выбора второго участника обмена, либо внутренняя валюта, нельзя изменить)
- Способ обмена со своей стороны, при этом пользователь указывает, как именно он будет передавать свой предмет. Если пользователь оплачивает предмет внутренней валютой, то способ по умолчанию = "внутренняя валюта"

После того как пользователь начнет обмен появится возможность общаться в чате.

##### 5.2.1. Способ обмена: личная встреча
Если указан способ обмена "личная встреча", то у второго пользователя способ обмена должен быть либо "личная встреча", либо "оплата внутренней валютой".

##### 5.2.2. Способ обмена: почтовый сервис
Если способ обмена - почтовый сервис, то пользователи (или только 1 из них) должны будут прислать трек-номер отслеживания в определенный срок. Если они этого не сделают, то им необходимо будет самостоятельно продлить обмен (он будет продлен в том же статусе) на фиксированное количество времени (необходимо согласование на продление от обоих пользователей)

После добавления обоих трекномеров обмен переходит в следующий статус

##### 5.2.3. Способ обмена: оплата внутренней валютой
Если у одного пользователя указан способ обмена "внутрення валюта", то у второго пользователя не может быть указан такой же способ обмена ("оплата внутренней валютой"). Валюта резервируется при переходе на следующий статус (если резервирование невозможно, то обмен отменяется из-за недостатка средств). Пользователь видит зарезервированную валюту в карточке обмена, текущий баланс пользователя отображается без ее учета
Второй участник обмена получает зарезервированную валюту (оплату за свой предмет) только после подтверждения получения товара другим юзером.

#### 5.3. Обмен в процессе
Обмен переходит в данный статус в следующих случаях:
- Способ обмена "почтовый сервис" и все трекномера указаны
- Способ обмена "личная встреча" (в этом статусе обмен можно завершить сразу)

#### 5.4. Обмен завершен
Обмен переходит в данный статус только из статуса "Обмен в процессе" при подтверждении обоими пользователями совершения обмена.

#### 5.5. Разрешение споров
Пользователи имеют возможность написать в поддержку на каждом этапе обмена, при этом они могут пожаловаться на других пользователей в случае обмана.

#### 5.6. Отмена обмена
Отмена обмена возможна только двумя пользователями, т.е. если только 1 участник обмена решил отменить обмен, то второй получит соответствующее уведомление, при этом он может не отменять обмен со своей стороны.
Отменить можно только обмены в статусе "обмен начат". Если один пользователь отменяет обмен, а второй нет, то спустя сутки обмен автоматически направляется в поддержку для рассмотрения причин данной ситуации.

#### 5.7. Рейтинг и отзывы по итогам обмена
Пользователи могут оставить отзыв и поставить оценку другому пользователю (с кем был обмен) по итогам взаимодействия (только если был создан обмен, при этом возможность оставить отзыв появляется только когда обмен был отменен или завершен).
Возможность оставить отзыв должна быть в карточке завершенного или отмененного обмена, при этом при отмене или завершении пользователю автоматически будет предоставлен экран для размещения оценки и отзыва на пользователя, с которым совершался обмен.

### 6. Чат
Пользователи имеют возможность общаться в чате в случае, если между ними есть обмен в статусе "Обмен начат", "Обмен в процессе", "Обмен завершен".
При этом пользователи могут добавлять других пользователей в "черный список" чтобы перестать получать от них сообщения.

### 7. Система рейтинга и отзывов
После завершения (в том числе отмены) обмена пользователи смогут выставлять друг-другу оценки (от 1 до 5). Рейтинг высчитывается как среднее от общей суммы оценок.
Так же вместе с рейтингом будет возможность оставить отзыв об участнике обмена.

### 9. Отображение просмотров и добавление в избранное
Пользователи могут добавлять в избранное и просматривать чужие предметы, доступные к обмену. Таким образом они смогут отслеживать состояние интересующего их предмета, а количество просмотров даст информацию об интересе к данному предмету

### 10. Отправка уведомлений
Приложение будет направлять пользователям уведомления в следующих ситуациях:
- Пользователю предложили обмен
- Обмен сменил статус
- Пользователь получил сообщение

### 11. Свайпы
Приложение будет иметь функционал, аналогичный тиндеру в плане свайпов, а именно:
пользователь будет заходить в раздел "поиск для обмена", где будет выбирать категории, на которые он хотел бы обменять какой-либо из своих предметов/внутреннюю валюту (функционал доступен даже есть у человека нет ни предметов ни внутренней валюты).
После того как все категории будут выбраны пользовател. будут предлагаться варианты, которые подходят под заданные фильтры, а он будет их "свайпать" влево/вправо в зависимости интересно ему или нет (свайп влево = неинтересно, свайп вправо = интересно).
Если был совершен свайп вправо, то необходимо будет сформировать предложение взамен, либо внутреннюю валюту, после чего предложит обмен, либо отменить свайп

### 12. Определение расстояния
У пользователей будет возможность задать комфортное для них расстояние, на котором они готовы совершать обмен (в км.)
При этом , работать только с примерным числом (с погрешностью в 1-5 км.), а не с точным местоположением пользователя, т.к. это не безопасно для них.
Потенциально узкое сложнореализуемое место.

### 13. Стек технологий
Backend:
- Python
- FastAPI
- SQLAlchemy
- PostgreSQL

Frontend:
- Flutter или React Native, важна кроссплатформенность

Хранение файлов и изображений, загружаемых юзерами, должно осуществляться в S3-совместимом хранилище.
### 14. Требования к дизайну
Минималистичный дизайн с преобладающим белым фоном, логотип приложения будет демонстрироваться в главном меню, при этом цветовая схема приложения должна соответствовать логотипу.
